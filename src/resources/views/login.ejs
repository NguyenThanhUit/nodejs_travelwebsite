<div class="login-container">
    <h1 class="login-h1">Đăng Nhập</h1>
    <form action="/login" method="POST">
        <div class="login-form-group">
            <label class="login-label" for="phone-number">Số điện thoại</label>
            <input class="login" type="text" id="phone-number" name="phone" required>
        </div>
        <div class="phone-err" id="phone-err"></div>
        <div class="login-form-group">
            <label class="login-label" for="password">Mật khẩu</label>
            <input class="login" type="password" id="password" name="password" required>
        </div>
        <div class="password-err" id="password-err"></div>
        <button class="login-button" type="submit">Đăng Nhập</button>
        <div class="login-links">
            <a class="login-dkitaikhoan" href="/signup">Đăng ký tài khoản</a> 
            <p class="text">|</p>
            <a class="login-forgot-password " href="/forgot_password">Quên mật khẩu?</a>
        </div>

        <div class="notification" id="notification"></div>
    </form>
</div>
<script>
    function validationPhone(phone){
        const startsWithZero = phone.startsWith("0")
        const isTenDigits = phone.length === 10
        return {
            startsWithZero,
            isTenDigits,
        }
    }
    function validationPassword(password) {
        const moreThanSevenCharacters = password.length > 7
        return {
            moreThanSevenCharacters,
        }
    }
    // show notification of login status
    function showNotification(message) {
        const notification = document.getElementById("notification")
        notification.innerText = message 
        notification.style.display = 'block'
        setTimeout( () => {
            notification.style.display = 'none'
        }, 3000)
    }

    document.addEventListener("DOMContentLoaded", function(){
        const form = document.querySelector('form')
        form.addEventListener("submit", (event) => {
            event.preventDefault()
            const phone = document.getElementById("phone-number").value
            const password = document.getElementById("password").value
            
            const phoneError = document.getElementById("phone-err")
            const passwordError = document.getElementById("password-err")

            phoneError.style.display = 'none'
            passwordError.style.display = 'none'

            let valid = true

            // check phone validation
            const validPhone = validationPhone(phone)
            if(!validPhone.startsWithZero) {
                phoneError.innerText = "Số điện thoại phải bắt đầu từ 0."
                phoneError.style.display = 'block'
                valid = false
            } else if(!validPhone.isTenDigits) {
                phoneError.innerText = "Số điện thoại phải có 10 chữ số."
                phoneError.style.display = 'block'
                valid = false
            }
            // check password validation
            if(!validationPassword(password).moreThanSevenCharacters){
                passwordError.innerText = "Mật khẩu phải có ít nhất 8 ký tự."
                passwordError.style.display = 'block'
                valid = false
            }
            if(valid) {
                fetch('/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({phone, password})
                })
                .then(response => response.json())
                .then(data => {
                    if(data.success){
                        window.location.href = '/homepage'
                    } else {
                        showNotification(data.message)
                    }
                })
            }
        })
    })
    const inputs = document.querySelectorAll('input')
    inputs.forEach(input => {
        input.addEventListener('focus', () => {
            const errorId = `${input.name}-err`
            const errorElement = document.getElementById(errorId)
            if(errorElement){
                errorElement.style.display = 'none'
            }
        })
    })


</script>